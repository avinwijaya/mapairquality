<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Monitoring</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Load the Earth Engine API library -->
    <script src="https://earthengine.googleapis.com/api/ee_api_js.js"></script>
    <style>
        #map { height: 400px; width: 100%; }
    </style>
</head>
<body>
    <h1>Air Quality Monitoring</h1>
    <div id="map"></div>
    <div id="info"></div>

    <script>
        // Function to initialize the application
        function init() {
            // Initialize Earth Engine
            ee.initialize({
                apiKey: 'YOUR_EARTH_ENGINE_API_KEY',
                onSuccess: function() {
                    console.log('Earth Engine initialized');
                    initMap();
                    getAirQualityData();
                },
                onFailure: function(e) {
                    console.error('Earth Engine failed to initialize', e);
                }
            });
        }

        // Initialize the map
        function initMap() {
            const map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -1.7459, lng: 118.4689},  // Center on Indonesia
                zoom: 5
            });

            // Store map in global variable for use in other functions
            window.map = map;
        }

        // Function to get air quality data
        function getAirQualityData() {
            // Example: get TROPOMI NO2 data
            var dataset = ee.ImageCollection('COPERNICUS/S5P/NRTI/L3_NO2')
                          .filterDate(ee.Date(Date.now()).advance(-1, 'day'), ee.Date(Date.now()));

            var band = 'NO2_column_number_density';

            var image = dataset.mean();
            var no2 = image.select(band);

            // Create the visualization parameters
            var vizParams = {
                min: 0,
                max: 0.0002,
                palette: ['black', 'blue', 'purple', 'cyan', 'green', 'yellow', 'red']
            };

            // Get the map id and token
            no2.getMap(vizParams, function(map_id, error) {
                if (error) {
                    console.error('Error generating map', error);
                    return;
                }

                // Create the overlay and add it to the map
                var overlay = new google.maps.ImageOverlay({
                    url: 'https://earthengine.googleapis.com/map/' + map_id.mapid + '/{z}/{x}/{y}?token=' + map_id.token,
                    map: window.map,
                    bounds: {
                        north: 85,
                        south: -85,
                        east: 180,
                        west: -180
                    }
                });
            });
        }

        // Call the init function when the page loads
        google.maps.event.addDomListener(window, 'load', init);
    </script>
</body>
</html>
